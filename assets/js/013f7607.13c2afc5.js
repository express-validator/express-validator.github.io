"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6361],{40796:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>d});var i=s(62540),c=s(43023);s(53371);const a={title:"checkExact",toc_max_heading_level:4},o="checkExact()",t={id:"api/check-exact",title:"checkExact",description:"checkExact()",source:"@site/versioned_docs/version-7.2.0/api/check-exact.md",sourceDirName:"api",slug:"/api/check-exact",permalink:"/docs/api/check-exact",draft:!1,unlisted:!1,editUrl:"https://github.com/express-validator/express-validator/edit/master/docs/versioned_docs/version-7.2.0/api/check-exact.md",tags:[],version:"7.2.0",frontMatter:{title:"checkExact",toc_max_heading_level:4},sidebar:"api",previous:{title:"check",permalink:"/docs/api/check"},next:{title:"checkSchema",permalink:"/docs/api/check-schema"}},l={},d=[{value:"<code>checkExact()</code>",id:"checkexact",level:2},{value:"The <code>locations</code> option",id:"locations-option",level:3},{value:"Examples",id:"examples",level:3},{value:"Without input validation chains",id:"example-without-chains",level:4},{value:"With <code>checkSchema()</code>",id:"example-schema",level:4},{value:"With the <code>locations</code> option",id:"example-locations",level:4},{value:"Manually running <code>checkExact()</code>",id:"example-manual",level:4},{value:"<code>UnknownFieldMessageFactory</code>",id:"unknownfieldmessagefactory",level:2}];function r(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"checkexact",children:(0,i.jsx)(n.code,{children:"checkExact()"})}),"\n",(0,i.jsx)(n.h2,{id:"checkexact",children:(0,i.jsx)(n.code,{children:"checkExact()"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"checkExact(\n  chains?: ValidationChain | ValidationChain[] | (ValidationChain | ValidationChain[])[],\n  options?: { locations?: Location[], message?: any }\n): Middleware & ContextRunner\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"checkExact()"})," middleware checks whether the request contains exactly only fields that have a\n",(0,i.jsx)(n.a,{href:"/docs/api/validation-chain",children:"validation chain"})," associated to them."]}),"\n",(0,i.jsxs)(n.p,{children:["A field is considered known by ",(0,i.jsx)(n.code,{children:"checkExact()"})," if there were validation chains specified for it\nbefore ",(0,i.jsx)(n.code,{children:"checkExact()"})," ran."]}),"\n",(0,i.jsxs)(n.p,{children:["If one or more validation chains are passed as argument to ",(0,i.jsx)(n.code,{children:"checkExact()"}),", then they will be run and\nthe fields targeted by them will be considered known, in addition to the validation chains previously\nspecified."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"app.post(\n  '/signup',\n  // All of name, email and password are known fields in req.body. Everything else is unknown.\n  body('name').notEmpty(),\n  checkExact([body('email').isEmail(), body('password').isLength({ min: 8 })], {\n    message: 'Too many fields specified',\n  }),\n  (req, res) => {\n    // Handle request\n  },\n);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If any unknown fields are found in the request, a ",(0,i.jsxs)(n.a,{href:"/docs/api/validation-result#unknownfieldvalidationerror",children:[(0,i.jsx)(n.code,{children:"UnknownFieldsError"})," error"]}),"\nis added to the request using the default message of ",(0,i.jsx)(n.code,{children:"Unknown field(s)"}),".\nThis message can be changed via ",(0,i.jsx)(n.code,{children:"options.message"}),", which if is a function,\nmust be a ",(0,i.jsx)(n.a,{href:"#unknownfieldmessagefactory",children:(0,i.jsx)(n.code,{children:"UnknownFieldMessageFactory"})}),"."]}),"\n",(0,i.jsxs)(n.admonition,{type:"caution",children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"checkExact()"})," ",(0,i.jsx)(n.strong,{children:"must"})," be the last validation middleware to run in your request,\notherwise it'll mark subsequent fields that have a validation chain as unknown ones."]}),(0,i.jsxs)(n.p,{children:["In the following example, the ",(0,i.jsx)(n.code,{children:"email"})," is a known field, but not ",(0,i.jsx)(n.code,{children:"subscribe"}),".\nTherefore, ",(0,i.jsx)(n.code,{children:"checkExact"})," will generate an error when ",(0,i.jsx)(n.code,{children:"subscribe"})," is specified in the request:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"app.post(\n  '/newsletter/subscription',\n  body('email').isEmail(),\n  checkExact(),\n  body('subscribe').isBoolean(),\n  (req, res) => {\n    // Handle request\n  },\n);\n"})})]}),"\n",(0,i.jsxs)(n.h3,{id:"locations-option",children:["The ",(0,i.jsx)(n.code,{children:"locations"})," option"]}),"\n",(0,i.jsxs)(n.p,{children:["The locations at which the ",(0,i.jsx)(n.code,{children:"checkExact()"})," checks for unknown fields can be customized by setting\n",(0,i.jsx)(n.code,{children:"options.locations"}),".",(0,i.jsx)(n.br,{}),"\n","By default, it includes only ",(0,i.jsx)(n.code,{children:"body"}),", ",(0,i.jsx)(n.code,{children:"params"})," and ",(0,i.jsx)(n.code,{children:"query"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"This is a sensible default to make sure that a user's valid requests don't fail because of aspects\nthat might be too hard to fix up:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["The HTTP specification lists a wide number of headers for varied use cases and reasons.",(0,i.jsx)(n.br,{}),"\n","You shouldn't need to specify all of them in order to avoid false negatives from ",(0,i.jsx)(n.code,{children:"checkExact()"}),";"]}),"\n",(0,i.jsxs)(n.li,{children:["Browsers and proxies are always introducing new headers, which makes the list of headers that need\nto be known for ",(0,i.jsx)(n.code,{children:"checkExact()"})," to work properly infinitely larger;"]}),"\n",(0,i.jsxs)(n.li,{children:["By default, browsers automatically pick up and send cookies along with every request.",(0,i.jsx)(n.br,{}),"\n","JavaScript ads or analytics scripts usually create cookies on the hosting website, which makes\nusing ",(0,i.jsx)(n.code,{children:"checkExact()"})," with cookies much more annoying."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["For these reasons, ",(0,i.jsx)(n.code,{children:"req.cookies"})," and ",(0,i.jsx)(n.code,{children:"req.headers"})," aren't checked for unknown fields ",(0,i.jsx)(n.em,{children:"by default"}),",\nthough you can include them by setting ",(0,i.jsx)(n.code,{children:"options.locations"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Unknown fields outside of ",(0,i.jsx)(n.code,{children:"options.locations"})," aren't reported."]}),"\n",(0,i.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(n.h4,{id:"example-without-chains",children:"Without input validation chains"}),"\n",(0,i.jsxs)(n.p,{children:["In this example, ",(0,i.jsx)(n.code,{children:"checkExact()"})," will see that ",(0,i.jsx)(n.code,{children:"email"})," and ",(0,i.jsx)(n.code,{children:"password"})," have validation chains,\nand won't mark them as unknown fields."]}),"\n",(0,i.jsxs)(n.p,{children:["Any other field present in ",(0,i.jsx)(n.code,{children:"req.body"}),", ",(0,i.jsx)(n.code,{children:"req.query"})," or ",(0,i.jsx)(n.code,{children:"req.params"})," will cause an\n",(0,i.jsx)(n.a,{href:"/docs/api/validation-result#unknownfieldvalidationerror",children:(0,i.jsx)(n.code,{children:"UnknownFieldValidationError"})}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"app.post(\n  '/signup',\n  body('email').isEmail(),\n  body('password').isLength({ min: 8 }),\n  checkExact([], { message: 'Only email and password are allowed' }),\n  (req, res) => {\n    // Handle request\n  },\n);\n"})}),"\n",(0,i.jsxs)(n.h4,{id:"example-schema",children:["With ",(0,i.jsx)(n.code,{children:"checkSchema()"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/docs/api/check-schema",children:(0,i.jsx)(n.code,{children:"checkSchema()"})})," returns a list of validation chains, which means it can be passed\nstraight to ",(0,i.jsx)(n.code,{children:"checkExact()"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"app.post(\n  '/signup',\n  checkExact(\n    checkSchema({\n      email: { isEmail: true },\n      password: { isLength: { options: { min: 8 } } },\n    }),\n  ),\n  (req, res) => {\n    // Handle request\n  },\n);\n"})}),"\n",(0,i.jsxs)(n.h4,{id:"example-locations",children:["With the ",(0,i.jsx)(n.code,{children:"locations"})," option"]}),"\n",(0,i.jsxs)(n.p,{children:["Say you wish to check only ",(0,i.jsx)(n.code,{children:"req.body"})," for unknown fields. Every other request location is OK to\ncontain unknown fields. You can do this with ",(0,i.jsxs)(n.a,{href:"#locations-option",children:["the ",(0,i.jsx)(n.code,{children:"locations"})," option"]}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"app.post(\n  '/signup',\n  body('email').isEmail(),\n  body('password').isLength({ min: 8 }),\n  checkExact([], { locations: ['body'] }),\n  (req, res) => {\n    // Handle request\n  },\n);\n"})}),"\n",(0,i.jsxs)(n.h4,{id:"example-manual",children:["Manually running ",(0,i.jsx)(n.code,{children:"checkExact()"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"checkExact()"})," returns a middleware, which makes it ideal to pass to an express.js route.\nBut since it also implements the ",(0,i.jsx)(n.a,{href:"/docs/api/misc#contextrunner",children:(0,i.jsx)(n.code,{children:"ContextRunner"})})," interface,\nyou can also run it manually, if you wish."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"app.post(\n  '/signup',\n  body('email').isEmail(),\n  body('password').isLength({ min: 8 }),\n  async (req, res) => {\n    const result = await checkExact().run(req);\n    if (result.isEmpty()) {\n      console.log('No unknown fields in the request');\n    }\n  },\n);\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["See the ",(0,i.jsx)(n.a,{href:"/docs/guides/manually-running",children:'"Manually running validations" guide'})," to learn more."]})}),"\n",(0,i.jsx)(n.h2,{id:"unknownfieldmessagefactory",children:(0,i.jsx)(n.code,{children:"UnknownFieldMessageFactory"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"type UnknownFieldMessageFactory = (\n  unknownFields: UnknownFieldInstance[],\n  opts: { req: Request },\n) => any;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The message factory type used when the ",(0,i.jsx)(n.code,{children:"checkExact()"})," ",(0,i.jsx)(n.code,{children:"message"})," option is a function."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"checkExact([body('name').notEmpty(), body('email').isEmail()], {\n  message: fields => {\n    const [field] = fields;\n    return `Unknown field ${field.path} in ${field.location} with value ${field.value}`;\n  },\n});\n"})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(r,{...e})}):r(e)}},53371:(e,n,s)=>{s.d(n,{Fy:()=>l,RW:()=>o,yT:()=>a,uL:()=>t});s(63696);const i={example:"example_yN0T",exampleTitle:"exampleTitle_uU28"};var c=s(62540),a=function(e){var n=e.children;return(0,c.jsx)("div",{className:i.example,children:n})},o=function(e){var n=e.title,s=e.children;return(0,c.jsxs)("div",{children:[(0,c.jsx)("strong",{className:i.exampleTitle,children:n}),s]})};function t(e){var n=e.children;return(0,c.jsxs)("div",{children:[(0,c.jsx)("strong",{className:i.exampleTitle,children:"Usage example"}),n]})}function l(e){var n=e.children;return(0,c.jsxs)("div",{children:[(0,c.jsx)("strong",{className:i.exampleTitle,children:"Error example"}),n]})}},43023:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>t});var i=s(63696);const c={},a=i.createContext(c);function o(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);