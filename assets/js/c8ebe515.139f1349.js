"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2330],{5318:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>h});var a=t(7378);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),c=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(s.Provider,{value:n},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(t),u=i,h=d["".concat(s,".").concat(u)]||d[u]||m[u]||o;return t?a.createElement(h,r(r({ref:n},p),{},{components:t})):a.createElement(h,r({ref:n},p))}));function h(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[d]="string"==typeof e?e:i,r[1]=l;for(var c=2;c<o;c++)r[c]=t[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},5857:(e,n,t)=>{t.d(n,{Kv:()=>c,Y$:()=>l,$L:()=>r,yV:()=>s});var a=t(7378);const i="example_yN0T",o="exampleTitle_uU28";var r=function(e){var n=e.children;return a.createElement("div",{className:i},n)},l=function(e){var n=e.title,t=e.children;return a.createElement("div",null,a.createElement("strong",{className:o},n),t)};function s(e){var n=e.children;return a.createElement("div",null,a.createElement("strong",{className:o},"Usage example"),n)}function c(e){var n=e.children;return a.createElement("div",null,a.createElement("strong",{className:o},"Error example"),n)}},8328:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>s,default:()=>u,frontMatter:()=>l,metadata:()=>c,toc:()=>d});var a=t(5773),i=t(808),o=(t(7378),t(5318)),r=(t(5857),["components"]),l={title:"checkExact",toc_max_heading_level:4},s="checkExact()",c={unversionedId:"api/check-exact",id:"api/check-exact",title:"checkExact",description:"checkExact()",source:"@site/../docs/api/check-exact.md",sourceDirName:"api",slug:"/api/check-exact",permalink:"/docs/next/api/check-exact",draft:!1,editUrl:"https://github.com/express-validator/express-validator/edit/master/docs/../docs/api/check-exact.md",tags:[],version:"current",frontMatter:{title:"checkExact",toc_max_heading_level:4},sidebar:"api",previous:{title:"check",permalink:"/docs/next/api/check"},next:{title:"checkSchema",permalink:"/docs/next/api/check-schema"}},p={},d=[{value:"<code>checkExact()</code>",id:"checkexact",level:2},{value:"The <code>locations</code> option",id:"locations-option",level:3},{value:"Examples",id:"examples",level:3},{value:"Without input validation chains",id:"example-without-chains",level:4},{value:"With <code>checkSchema()</code>",id:"example-schema",level:4},{value:"With the <code>locations</code> option",id:"example-locations",level:4},{value:"Manually running <code>checkExact()</code>",id:"example-manual",level:4},{value:"<code>UnknownFieldMessageFactory</code>",id:"unknownfieldmessagefactory",level:2}],m={toc:d};function u(e){var n=e.components,t=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"checkexact"},(0,o.kt)("inlineCode",{parentName:"h1"},"checkExact()")),(0,o.kt)("h2",{id:"checkexact"},(0,o.kt)("inlineCode",{parentName:"h2"},"checkExact()")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"checkExact(\n  chains?: ValidationChain | ValidationChain[] | (ValidationChain | ValidationChain[])[],\n  options?: { locations?: Location[], message?: any }\n): Middleware & ContextRunner\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"checkExact()")," middleware checks whether the request contains exactly only fields that have a\n",(0,o.kt)("a",{parentName:"p",href:"/docs/next/api/validation-chain"},"validation chain")," associated to them."),(0,o.kt)("p",null,"A field is considered known by ",(0,o.kt)("inlineCode",{parentName:"p"},"checkExact()")," if there were validation chains specified for it\nbefore ",(0,o.kt)("inlineCode",{parentName:"p"},"checkExact()")," ran."),(0,o.kt)("p",null,"If one or more validation chains are passed as argument to ",(0,o.kt)("inlineCode",{parentName:"p"},"checkExact()"),", then they will be run and\nthe fields targeted by them will be considered known, in addition to the validation chains previously\nspecified."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"app.post(\n  '/signup',\n  // All of name, email and password are known fields in req.body. Everything else is unknown.\n  body('name').notEmpty(),\n  checkExact([body('email').isEmail(), body('password').isLength({ min: 8 })], {\n    message: 'Too many fields specified',\n  }),\n  (req, res) => {\n    // Handle request\n  },\n);\n")),(0,o.kt)("p",null,"If any unknown fields are found in the request, a ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/api/validation-result#unknownfieldvalidationerror"},(0,o.kt)("inlineCode",{parentName:"a"},"UnknownFieldsError")," error"),"\nis added to the request using the default message of ",(0,o.kt)("inlineCode",{parentName:"p"},"Unknown field(s)"),".\nThis message can be changed via ",(0,o.kt)("inlineCode",{parentName:"p"},"options.message"),", which if is a function,\nmust be a ",(0,o.kt)("a",{parentName:"p",href:"#unknownfieldmessagefactory"},(0,o.kt)("inlineCode",{parentName:"a"},"UnknownFieldMessageFactory")),"."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("inlineCode",{parentName:"p"},"checkExact()")," ",(0,o.kt)("strong",{parentName:"p"},"must")," be the last validation middleware to run in your request,\notherwise it'll mark subsequent fields that have a validation chain as unknown ones."),(0,o.kt)("p",{parentName:"admonition"},"In the following example, the ",(0,o.kt)("inlineCode",{parentName:"p"},"email")," is a known field, but not ",(0,o.kt)("inlineCode",{parentName:"p"},"subscribe"),".\nTherefore, ",(0,o.kt)("inlineCode",{parentName:"p"},"checkExact")," will generate an error when ",(0,o.kt)("inlineCode",{parentName:"p"},"subscribe")," is specified in the request:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"app.post(\n  '/newsletter/subscription',\n  body('email').isEmail(),\n  checkExact(),\n  body('subscribe').isBoolean(),\n  (req, res) => {\n    // Handle request\n  },\n);\n"))),(0,o.kt)("h3",{id:"locations-option"},"The ",(0,o.kt)("inlineCode",{parentName:"h3"},"locations")," option"),(0,o.kt)("p",null,"The locations at which the ",(0,o.kt)("inlineCode",{parentName:"p"},"checkExact()")," checks for unknown fields can be customized by setting\n",(0,o.kt)("inlineCode",{parentName:"p"},"options.locations"),".",(0,o.kt)("br",{parentName:"p"}),"\n","By default, it includes only ",(0,o.kt)("inlineCode",{parentName:"p"},"body"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"params")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"query"),"."),(0,o.kt)("p",null,"This is a sensible default to make sure that a user's valid requests don't fail because of aspects\nthat might be too hard to fix up:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"The HTTP specification lists a wide number of headers for varied use cases and reasons.",(0,o.kt)("br",{parentName:"li"}),"You shouldn't need to specify all of them in order to avoid false negatives from ",(0,o.kt)("inlineCode",{parentName:"li"},"checkExact()"),";"),(0,o.kt)("li",{parentName:"ol"},"Browsers and proxies are always introducing new headers, which makes the list of headers that need\nto be known for ",(0,o.kt)("inlineCode",{parentName:"li"},"checkExact()")," to work properly infinitely larger;"),(0,o.kt)("li",{parentName:"ol"},"By default, browsers automatically pick up and send cookies along with every request.",(0,o.kt)("br",{parentName:"li"}),"JavaScript ads or analytics scripts usually create cookies on the hosting website, which makes\nusing ",(0,o.kt)("inlineCode",{parentName:"li"},"checkExact()")," with cookies much more annoying.")),(0,o.kt)("p",null,"For these reasons, ",(0,o.kt)("inlineCode",{parentName:"p"},"req.cookies")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"req.headers")," aren't checked for unknown fields ",(0,o.kt)("em",{parentName:"p"},"by default"),",\nthough you can include them by setting ",(0,o.kt)("inlineCode",{parentName:"p"},"options.locations"),"."),(0,o.kt)("p",null,"Unknown fields outside of ",(0,o.kt)("inlineCode",{parentName:"p"},"options.locations")," aren't reported."),(0,o.kt)("h3",{id:"examples"},"Examples"),(0,o.kt)("h4",{id:"example-without-chains"},"Without input validation chains"),(0,o.kt)("p",null,"In this example, ",(0,o.kt)("inlineCode",{parentName:"p"},"checkExact()")," will see that ",(0,o.kt)("inlineCode",{parentName:"p"},"email")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"password")," have validation chains,\nand won't mark them as unknown fields."),(0,o.kt)("p",null,"Any other field present in ",(0,o.kt)("inlineCode",{parentName:"p"},"req.body"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"req.query")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"req.params")," will cause an\n",(0,o.kt)("a",{parentName:"p",href:"/docs/next/api/validation-result#unknownfieldvalidationerror"},(0,o.kt)("inlineCode",{parentName:"a"},"UnknownFieldValidationError")),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"app.post(\n  '/signup',\n  body('email').isEmail(),\n  body('password').isLength({ min: 8 }),\n  checkExact([], { message: 'Only email and password are allowed' }),\n  (req, res) => {\n    // Handle request\n  },\n);\n")),(0,o.kt)("h4",{id:"example-schema"},"With ",(0,o.kt)("inlineCode",{parentName:"h4"},"checkSchema()")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/docs/next/api/check-schema"},(0,o.kt)("inlineCode",{parentName:"a"},"checkSchema()"))," returns a list of validation chains, which means it can be passed\nstraight to ",(0,o.kt)("inlineCode",{parentName:"p"},"checkExact()"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"app.post(\n  '/signup',\n  checkExact(\n    checkSchema({\n      email: { isEmail: true },\n      password: { isLength: { options: { min: 8 } } },\n    }),\n  ),\n  (req, res) => {\n    // Handle request\n  },\n);\n")),(0,o.kt)("h4",{id:"example-locations"},"With the ",(0,o.kt)("inlineCode",{parentName:"h4"},"locations")," option"),(0,o.kt)("p",null,"Say you wish to check only ",(0,o.kt)("inlineCode",{parentName:"p"},"req.body")," for unknown fields. Every other request location is OK to\ncontain unknown fields. You can do this with ",(0,o.kt)("a",{parentName:"p",href:"#locations-option"},"the ",(0,o.kt)("inlineCode",{parentName:"a"},"locations")," option"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"app.post(\n  '/signup',\n  body('email').isEmail(),\n  body('password').isLength({ min: 8 }),\n  checkExact([], { locations: ['body'] }),\n  (req, res) => {\n    // Handle request\n  },\n);\n")),(0,o.kt)("h4",{id:"example-manual"},"Manually running ",(0,o.kt)("inlineCode",{parentName:"h4"},"checkExact()")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"checkExact()")," returns a middleware, which makes it ideal to pass to an express.js route.\nBut since it also implements the ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/api/misc#contextrunner"},(0,o.kt)("inlineCode",{parentName:"a"},"ContextRunner"))," interface,\nyou can also run it manually, if you wish."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"app.post(\n  '/signup',\n  body('email').isEmail(),\n  body('password').isLength({ min: 8 }),\n  async (req, res) => {\n    const result = await checkExact().run(req);\n    if (result.isEmpty()) {\n      console.log('No unknown fields in the request');\n    }\n  },\n);\n")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"See the ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/guides/manually-running"},'"Manually running validations" guide')," to learn more.")),(0,o.kt)("h2",{id:"unknownfieldmessagefactory"},(0,o.kt)("inlineCode",{parentName:"h2"},"UnknownFieldMessageFactory")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"type UnknownFieldMessageFactory = (\n  unknownFields: UnknownFieldInstance[],\n  opts: { req: Request },\n) => any;\n")),(0,o.kt)("p",null,"The message factory type used when the ",(0,o.kt)("inlineCode",{parentName:"p"},"checkExact()")," ",(0,o.kt)("inlineCode",{parentName:"p"},"message")," option is a function."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"checkExact([body('name').notEmpty(), body('email').isEmail()], {\n  message: fields => {\n    const [field] = fields;\n    return `Unknown field ${field.path} in ${field.location} with value ${field.value}`;\n  },\n});\n")))}u.isMDXComponent=!0}}]);